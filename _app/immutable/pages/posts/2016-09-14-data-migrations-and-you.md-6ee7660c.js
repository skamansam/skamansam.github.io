import{S as Jn,i as Kn,s as Qn,D as zt,x as Xn,y as eo,z as ao,A as to,B as Hn,r as no,p as oo,C as so,L as Bn,e as n,t as r,k as c,c as o,a as s,h as i,d as t,m as p,b as h,g as ro,I as e,n as io}from"../../chunks/index-fb0fe4b0.js";import{P as lo}from"../../chunks/post-72541c77.js";function co(S){let a,u,v,x,d,m,k,We,Ze,C,N,Je,L,ee,Y,Ke,Qe,ae,j,Xe,ea,H,aa,ta,f,na,te,oa,sa,ne,ra,ia,oe,la,ca,pa,B,da,ha,b,ua,se,ma,ga,re,fa,ya,wa,ie,y,le,va,ka,V,zn=`<code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">CreateMessageFavorites</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">up</span></span>
    create_table <span class="token symbol">:message_favorites</span> <span class="token keyword">do</span> <span class="token operator">|</span>t<span class="token operator">|</span>
      t<span class="token punctuation">.</span>references <span class="token symbol">:message</span>
      t<span class="token punctuation">.</span>references <span class="token symbol">:user</span>
      t<span class="token punctuation">.</span>boolean    <span class="token symbol">:favorite</span>
      t<span class="token punctuation">.</span>timestamps  null<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token keyword">end</span>
  <span class="token keyword">end</span>

  <span class="token keyword">def</span> <span class="token method-definition"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">down</span></span>
    drop_table <span class="token symbol">:message_favorites</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code>`,ba,P,_a,ce,Ea,Ra,Ia,D,Ta,pe,Oa,Ma,Aa,z,Un=`<code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">UpdateMessageFavoritesToHandleMoreEmotions</span> <span class="token operator">&lt;</span> ActiveRecord<span class="token double-colon punctuation">::</span>Migration
  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">change</span></span>
    add_column <span class="token symbol">:message_favorites</span><span class="token punctuation">,</span> <span class="token symbol">:favorite_int</span><span class="token punctuation">,</span> <span class="token symbol">:int</span>

    MessageFavorite<span class="token punctuation">.</span>all<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>mf<span class="token operator">|</span>
      mf<span class="token punctuation">.</span>update_attributes<span class="token punctuation">(</span><span class="token symbol">favorite_int</span><span class="token operator">:</span> MessageFavorite<span class="token double-colon punctuation">::</span><span class="token constant">EMOTIONS</span><span class="token punctuation">[</span>mf<span class="token punctuation">.</span>favorite <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">end</span>

    remove_column <span class="token symbol">:message_favorites</span><span class="token punctuation">,</span> <span class="token symbol">:favorite</span>
    rename_column <span class="token symbol">:message_favorites</span><span class="token punctuation">,</span> <span class="token symbol">:favorite_int</span><span class="token punctuation">,</span> <span class="token symbol">:favorite</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span></code>`,xa,de,La,Pa,he,Da,Fa,F,Sa,ue,Ca,Na,Ya,_,me,ja,Ha,ge,Ba,Va,fe,za,Ua,ye,$a,Ga,E,we,qa,Wa,ve,Za,Ja,ke,Ka,Qa,be,Xa,et,U,at,tt,R,nt,_e,ot,st,Ee,rt,it,lt,g,ct,Re,pt,dt,Ie,ht,ut,Te,mt,gt,Oe,ft,yt,wt,$,vt,kt,G,$n=`<code class="language-mermaid"><span class="token comment">%% Waiting for the following chart to load...</span>
<span class="token keyword">graph</span> TB<span class="token punctuation">;</span>
  db?<span class="token text string">&#123;database needs to be changed?&#125;</span>
  done<span class="token text string">[Done.]</span>
  db<span class="token text string">["Run database migration (rails migration)"]</span>
  data?<span class="token text string">&#123;data need to be changed?&#125;</span>
  data<span class="token text string">["run script to change data (one-shot)"]</span>
  db_cleanup?<span class="token text string">&#123;database needs cleanup?&#125;</span>
  db? <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">yes</span> <span class="token arrow operator">--></span></span> db
  db? <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">no</span>  <span class="token arrow operator">--></span></span> done
  db  <span class="token arrow operator">--></span> data?
  data? <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">no</span> <span class="token arrow operator">--></span></span>done
  data? <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">yes</span> <span class="token arrow operator">--></span></span> data
  data <span class="token arrow operator">--></span> db_cleanup?
  db_cleanup? <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">yes</span> <span class="token arrow operator">--></span></span> db
  db_cleanup? <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">no</span> <span class="token arrow operator">--></span></span> done</code>`,bt,Me,_t,Ae,Et,Rt,I,xe,O,It,Le,Tt,Ot,Pe,Mt,At,De,M,xt,Fe,Lt,Pt,Se,Dt,Ft,Ce,T,St,Ne,Ct,Nt,Ye,Yt,jt,Ht,je,Bt;return{c(){a=n("nav"),u=n("h2"),v=r("On This Page"),x=c(),d=n("ul"),m=n("li"),k=n("a"),We=r("A Little Background"),Ze=c(),C=n("li"),N=n("a"),Je=r("Migrations Are Only For Modifying The Database"),L=n("ul"),ee=n("li"),Y=n("a"),Ke=r("Introducing Rails Runner"),Qe=c(),ae=n("li"),j=n("a"),Xe=r("Flow for Data Migrations"),ea=c(),H=n("h2"),aa=r("A Little Background"),ta=c(),f=n("p"),na=r(`The university from which I graduated did not teach any programming patterns, so when I entered the job market, I was not
sure what `),te=n("em"),oa=r("programming patterns"),sa=r(" (a.k.a. \u201D"),ne=n("em"),ra=r("design patterns"),ia=r(`\u201D)\xA0even were. My first job was definitely a learning experience,
but since I was on a small team with other newbies, I didn\u2019t have many opportunities to grow well as a developer. So when
I got my second job, with developers of all walks and experiences, I was thrown into many, many discussions about what
pattern to apply to what idea. It was a little confusing at first, but very exhilarating! Here was the chance to lose
some old, bad habits, and replace them with new `),oe=n("em"),la=r("Patterns"),ca=r(`! This post is about some patterns I really really like.
I will add references and information about each pattern so you can learn as much about them them as you want!`),pa=c(),B=n("h2"),da=r("Migrations Are Only For Modifying The Database"),ha=c(),b=n("p"),ua=r(`This is a difficult rule to follow for lots of Rails developers, experienced and not so. Since migrations are usually
automated, it is easy to get in the mindset of adding data changes to migrations. This violates the
`),se=n("strong"),ma=r("Single Responsibility Principle"),ga=r(", which states, "),re=n("em"),fa=r("A class should have a responsibility over a single feature of your application"),ya=r("."),wa=c(),ie=n("blog-note"),y=n("div"),le=n("p"),va=r(`Scenario: You have a nice chat app and you want to add the ability for users to \u2018favorite\u2019 certain messages.
At first, you have a boolean field in your database, so your original migration looks like this:`),ka=c(),V=n("pre"),ba=c(),P=n("p"),_a=r("After a few months, and many "),ce=n("em"),Ea=r("many"),Ra=r(` messages (6 million!), you decide you want the \u2018favorite\u2019 button to handle
a few more emotions, such as \u201Cmakes me happy,\u201D \u201Cmakes me sad,\u201D \u201Cmakes me angry,\u201D \u201Cmakes me crazy,\u201D and \u201Cmeh,
just a note.\u201D`),Ia=c(),D=n("p"),Ta=r(`There are several ways of going about doing this. Once you analyze your requirements, you decide to use the
existing `),pe=n("code"),Oa=r("MessageFavorite#favorite"),Ma=r(` field to store the new information.Your immediate thought is to use a
migration as such:`),Aa=c(),z=n("pre"),xa=c(),de=n("p"),La=r(`There are a few problems with this approach, chiefly, running a data migration in the middle of a Rails
migration like this is going to grind things to a halt. Your deploy is going to take forever! There is also an
issue of what happens when there is an error in your data migration which will prevent everything from happening
and could leave you with dangling data that another migration won\u2019t be able to fix.`),Pa=c(),he=n("p"),Da=r(`Change in environment is also a big issue. You may have this thoroughly tested while in development or in testing
environments, but production is known to throw a wrench into the works. This untested environment means you need
to baby-sit your data migration, which you won\u2019t be able to do while it\u2019s in a deploy migration. You will need
to run this separately, in a production console.`),Fa=c(),F=n("p"),Sa=r("Finally, there is the obvious issue of violations to the "),ue=n("strong"),Ca=r("SRP"),Na=r(". This migration does three things:"),Ya=c(),_=n("ol"),me=n("li"),ja=r("creates a new temporary column"),Ha=c(),ge=n("li"),Ba=r("creates the new data based on the existing data"),Va=c(),fe=n("li"),za=r("replaces the original column with the new column"),Ua=c(),ye=n("p"),$a=r("The best way to address all these issues is to just break the migration up into its distinct pieces, by doing the following:"),Ga=c(),E=n("ol"),we=n("li"),qa=r("create and run a migration to create a new column in the Db"),Wa=c(),ve=n("li"),Za=r("run the data migration (in the production console)"),Ja=c(),ke=n("li"),Ka=r("create and run a migration to replace the old column with the new one"),Qa=c(),be=n("p"),Xa=r(`For many of us, step 2 is a very daunting task. Rails consoles in production are a hairy endeavor and can lead to bad
data integrity and other sorts of bad things, including deleting all data! Fortunately for you guys, Rails already
has a solution for this.`),et=c(),U=n("h3"),at=r("Introducing Rails Runner"),tt=c(),R=n("p"),nt=r(`Rails runner is a great tool for running data migrations and other one-shot data changes in your Rails application. Rails
runner runs a given file in the context of your Rails app. You can execute Rails runner as `),_e=n("code"),ot=r("rails runner bin/file.rb"),st=r(` or
`),Ee=n("code"),rt=r("rails r bin/file.rb"),it=r(`. While this won\u2019t solve data integrity issues, it will allow you to run a script in the current
Rails context. This means you can have tested and peer reviewed data migrations! Amazing!`),lt=c(),g=n("p"),ct=r("For ease of organization, you can put all your data migrations in "),Re=n("code"),pt=r("db/migrate/data/"),dt=r(`. Another common place is
`),Ie=n("code"),ht=r("bin/one-shot/:year/:month/"),ut=r(`. If this is a hotfix for a tech support ticket, it is helpful to put the ticket number
in the name of the file, for instance `),Te=n("code"),mt=r("bin/one-shot/2016/09/TS-432098-update-bad-data.rb"),gt=r(`. The point is, your team
should agree on a place to put all these tickets so everyone can keep track of the changes. Developers can add a
`),Oe=n("code"),ft=r("post_checkout"),yt=r(" git hook to automatically run all new scripts in the agreed-upon directory."),wt=c(),$=n("h3"),vt=r("Flow for Data Migrations"),kt=c(),G=n("pre"),bt=c(),Me=n("div"),_t=c(),Ae=n("p"),Et=r("If you want to run any migration in Rails, just follow these easy steps:"),Rt=c(),I=n("ol"),xe=n("li"),O=n("p"),It=r("For data migrations, create a one-shot and use "),Le=n("code"),Tt=r("rails runner"),Ot=r(`. This is a best practice because it allows your
team to test and review your changes. `),Pe=n("strong"),Mt=r("NEVER EVER EVER RUN A PRODUCTION CONSOLE!"),At=c(),De=n("li"),M=n("p"),xt=r("Use "),Fe=n("code"),Lt=r("rails migrations"),Pt=c(),Se=n("strong"),Dt=r("FOR DATABASE MODEL CHANGES ONLY"),Ft=c(),Ce=n("li"),T=n("p"),St=r("Apply rules "),Ne=n("em"),Ct=r("1"),Nt=r(" and "),Ye=n("em"),Yt=r("2"),jt=r(" as liberally as possible."),Ht=c(),je=n("p"),Bt=r(`If you want to create a data migration, use one-shots. If you want to create a data migration with a database
change, separate the two concerns into a Rails migration, then a data migration, then a cleanup migration if
needed. Of course, YMMV, as with any best practice, just make sure your team is onboard with it and, above all,
remember that agreeing on standard practices is the core of a happy team!`),this.h()},l(He){a=o(He,"NAV",{class:!0});var l=s(a);u=o(l,"H2",{id:!0});var Ut=s(u);v=i(Ut,"On This Page"),Ut.forEach(t),x=p(l),d=o(l,"UL",{});var ze=s(d);m=o(ze,"LI",{});var $t=s(m);k=o($t,"A",{href:!0});var Gt=s(k);We=i(Gt,"A Little Background"),Gt.forEach(t),$t.forEach(t),Ze=p(ze),C=o(ze,"LI",{});var Vt=s(C);N=o(Vt,"A",{href:!0});var qt=s(N);Je=i(qt,"Migrations Are Only For Modifying The Database"),qt.forEach(t),L=o(Vt,"UL",{});var Ue=s(L);ee=o(Ue,"LI",{});var Wt=s(ee);Y=o(Wt,"A",{href:!0});var Zt=s(Y);Ke=i(Zt,"Introducing Rails Runner"),Zt.forEach(t),Wt.forEach(t),Qe=p(Ue),ae=o(Ue,"LI",{});var Jt=s(ae);j=o(Jt,"A",{href:!0});var Kt=s(j);Xe=i(Kt,"Flow for Data Migrations"),Kt.forEach(t),Jt.forEach(t),Ue.forEach(t),Vt.forEach(t),ze.forEach(t),ea=p(l),H=o(l,"H2",{id:!0});var Qt=s(H);aa=i(Qt,"A Little Background"),Qt.forEach(t),ta=p(l),f=o(l,"P",{});var A=s(f);na=i(A,`The university from which I graduated did not teach any programming patterns, so when I entered the job market, I was not
sure what `),te=o(A,"EM",{});var Xt=s(te);oa=i(Xt,"programming patterns"),Xt.forEach(t),sa=i(A," (a.k.a. \u201D"),ne=o(A,"EM",{});var en=s(ne);ra=i(en,"design patterns"),en.forEach(t),ia=i(A,`\u201D)\xA0even were. My first job was definitely a learning experience,
but since I was on a small team with other newbies, I didn\u2019t have many opportunities to grow well as a developer. So when
I got my second job, with developers of all walks and experiences, I was thrown into many, many discussions about what
pattern to apply to what idea. It was a little confusing at first, but very exhilarating! Here was the chance to lose
some old, bad habits, and replace them with new `),oe=o(A,"EM",{});var an=s(oe);la=i(an,"Patterns"),an.forEach(t),ca=i(A,`! This post is about some patterns I really really like.
I will add references and information about each pattern so you can learn as much about them them as you want!`),A.forEach(t),pa=p(l),B=o(l,"H2",{id:!0});var tn=s(B);da=i(tn,"Migrations Are Only For Modifying The Database"),tn.forEach(t),ha=p(l),b=o(l,"P",{});var q=s(b);ua=i(q,`This is a difficult rule to follow for lots of Rails developers, experienced and not so. Since migrations are usually
automated, it is easy to get in the mindset of adding data changes to migrations. This violates the
`),se=o(q,"STRONG",{});var nn=s(se);ma=i(nn,"Single Responsibility Principle"),nn.forEach(t),ga=i(q,", which states, "),re=o(q,"EM",{});var on=s(re);fa=i(on,"A class should have a responsibility over a single feature of your application"),on.forEach(t),ya=i(q,"."),q.forEach(t),wa=p(l),ie=o(l,"BLOG-NOTE",{});var sn=s(ie);y=o(sn,"DIV",{class:!0});var W=s(y);le=o(W,"P",{});var rn=s(le);va=i(rn,`Scenario: You have a nice chat app and you want to add the ability for users to \u2018favorite\u2019 certain messages.
At first, you have a boolean field in your database, so your original migration looks like this:`),rn.forEach(t),ka=p(W),V=o(W,"PRE",{class:!0});var Gn=s(V);Gn.forEach(t),ba=p(W),P=o(W,"P",{});var $e=s(P);_a=i($e,"After a few months, and many "),ce=o($e,"EM",{});var ln=s(ce);Ea=i(ln,"many"),ln.forEach(t),Ra=i($e,` messages (6 million!), you decide you want the \u2018favorite\u2019 button to handle
a few more emotions, such as \u201Cmakes me happy,\u201D \u201Cmakes me sad,\u201D \u201Cmakes me angry,\u201D \u201Cmakes me crazy,\u201D and \u201Cmeh,
just a note.\u201D`),$e.forEach(t),W.forEach(t),sn.forEach(t),Ia=p(l),D=o(l,"P",{});var Ge=s(D);Ta=i(Ge,`There are several ways of going about doing this. Once you analyze your requirements, you decide to use the
existing `),pe=o(Ge,"CODE",{});var cn=s(pe);Oa=i(cn,"MessageFavorite#favorite"),cn.forEach(t),Ma=i(Ge,` field to store the new information.Your immediate thought is to use a
migration as such:`),Ge.forEach(t),Aa=p(l),z=o(l,"PRE",{class:!0});var qn=s(z);qn.forEach(t),xa=p(l),de=o(l,"P",{});var pn=s(de);La=i(pn,`There are a few problems with this approach, chiefly, running a data migration in the middle of a Rails
migration like this is going to grind things to a halt. Your deploy is going to take forever! There is also an
issue of what happens when there is an error in your data migration which will prevent everything from happening
and could leave you with dangling data that another migration won\u2019t be able to fix.`),pn.forEach(t),Pa=p(l),he=o(l,"P",{});var dn=s(he);Da=i(dn,`Change in environment is also a big issue. You may have this thoroughly tested while in development or in testing
environments, but production is known to throw a wrench into the works. This untested environment means you need
to baby-sit your data migration, which you won\u2019t be able to do while it\u2019s in a deploy migration. You will need
to run this separately, in a production console.`),dn.forEach(t),Fa=p(l),F=o(l,"P",{});var qe=s(F);Sa=i(qe,"Finally, there is the obvious issue of violations to the "),ue=o(qe,"STRONG",{});var hn=s(ue);Ca=i(hn,"SRP"),hn.forEach(t),Na=i(qe,". This migration does three things:"),qe.forEach(t),Ya=p(l),_=o(l,"OL",{});var Z=s(_);me=o(Z,"LI",{});var un=s(me);ja=i(un,"creates a new temporary column"),un.forEach(t),Ha=p(Z),ge=o(Z,"LI",{});var mn=s(ge);Ba=i(mn,"creates the new data based on the existing data"),mn.forEach(t),Va=p(Z),fe=o(Z,"LI",{});var gn=s(fe);za=i(gn,"replaces the original column with the new column"),gn.forEach(t),Z.forEach(t),Ua=p(l),ye=o(l,"P",{});var fn=s(ye);$a=i(fn,"The best way to address all these issues is to just break the migration up into its distinct pieces, by doing the following:"),fn.forEach(t),Ga=p(l),E=o(l,"OL",{});var J=s(E);we=o(J,"LI",{});var yn=s(we);qa=i(yn,"create and run a migration to create a new column in the Db"),yn.forEach(t),Wa=p(J),ve=o(J,"LI",{});var wn=s(ve);Za=i(wn,"run the data migration (in the production console)"),wn.forEach(t),Ja=p(J),ke=o(J,"LI",{});var vn=s(ke);Ka=i(vn,"create and run a migration to replace the old column with the new one"),vn.forEach(t),J.forEach(t),Qa=p(l),be=o(l,"P",{});var kn=s(be);Xa=i(kn,`For many of us, step 2 is a very daunting task. Rails consoles in production are a hairy endeavor and can lead to bad
data integrity and other sorts of bad things, including deleting all data! Fortunately for you guys, Rails already
has a solution for this.`),kn.forEach(t),et=p(l),U=o(l,"H3",{id:!0});var bn=s(U);at=i(bn,"Introducing Rails Runner"),bn.forEach(t),tt=p(l),R=o(l,"P",{});var K=s(R);nt=i(K,`Rails runner is a great tool for running data migrations and other one-shot data changes in your Rails application. Rails
runner runs a given file in the context of your Rails app. You can execute Rails runner as `),_e=o(K,"CODE",{});var _n=s(_e);ot=i(_n,"rails runner bin/file.rb"),_n.forEach(t),st=i(K,` or
`),Ee=o(K,"CODE",{});var En=s(Ee);rt=i(En,"rails r bin/file.rb"),En.forEach(t),it=i(K,`. While this won\u2019t solve data integrity issues, it will allow you to run a script in the current
Rails context. This means you can have tested and peer reviewed data migrations! Amazing!`),K.forEach(t),lt=p(l),g=o(l,"P",{});var w=s(g);ct=i(w,"For ease of organization, you can put all your data migrations in "),Re=o(w,"CODE",{});var Rn=s(Re);pt=i(Rn,"db/migrate/data/"),Rn.forEach(t),dt=i(w,`. Another common place is
`),Ie=o(w,"CODE",{});var In=s(Ie);ht=i(In,"bin/one-shot/:year/:month/"),In.forEach(t),ut=i(w,`. If this is a hotfix for a tech support ticket, it is helpful to put the ticket number
in the name of the file, for instance `),Te=o(w,"CODE",{});var Tn=s(Te);mt=i(Tn,"bin/one-shot/2016/09/TS-432098-update-bad-data.rb"),Tn.forEach(t),gt=i(w,`. The point is, your team
should agree on a place to put all these tickets so everyone can keep track of the changes. Developers can add a
`),Oe=o(w,"CODE",{});var On=s(Oe);ft=i(On,"post_checkout"),On.forEach(t),yt=i(w," git hook to automatically run all new scripts in the agreed-upon directory."),w.forEach(t),wt=p(l),$=o(l,"H3",{id:!0});var Mn=s($);vt=i(Mn,"Flow for Data Migrations"),Mn.forEach(t),kt=p(l),G=o(l,"PRE",{class:!0});var Wn=s(G);Wn.forEach(t),bt=p(l),Me=o(l,"DIV",{class:!0});var Zn=s(Me);Zn.forEach(t),_t=p(l),Ae=o(l,"P",{});var An=s(Ae);Et=i(An,"If you want to run any migration in Rails, just follow these easy steps:"),An.forEach(t),Rt=p(l),I=o(l,"OL",{});var Q=s(I);xe=o(Q,"LI",{});var xn=s(xe);O=o(xn,"P",{});var Be=s(O);It=i(Be,"For data migrations, create a one-shot and use "),Le=o(Be,"CODE",{});var Ln=s(Le);Tt=i(Ln,"rails runner"),Ln.forEach(t),Ot=i(Be,`. This is a best practice because it allows your
team to test and review your changes. `),Pe=o(Be,"STRONG",{});var Pn=s(Pe);Mt=i(Pn,"NEVER EVER EVER RUN A PRODUCTION CONSOLE!"),Pn.forEach(t),Be.forEach(t),xn.forEach(t),At=p(Q),De=o(Q,"LI",{});var Dn=s(De);M=o(Dn,"P",{});var Ve=s(M);xt=i(Ve,"Use "),Fe=o(Ve,"CODE",{});var Fn=s(Fe);Lt=i(Fn,"rails migrations"),Fn.forEach(t),Pt=p(Ve),Se=o(Ve,"STRONG",{});var Sn=s(Se);Dt=i(Sn,"FOR DATABASE MODEL CHANGES ONLY"),Sn.forEach(t),Ve.forEach(t),Dn.forEach(t),Ft=p(Q),Ce=o(Q,"LI",{});var Cn=s(Ce);T=o(Cn,"P",{});var X=s(T);St=i(X,"Apply rules "),Ne=o(X,"EM",{});var Nn=s(Ne);Ct=i(Nn,"1"),Nn.forEach(t),Nt=i(X," and "),Ye=o(X,"EM",{});var Yn=s(Ye);Yt=i(Yn,"2"),Yn.forEach(t),jt=i(X," as liberally as possible."),X.forEach(t),Cn.forEach(t),Q.forEach(t),Ht=p(l),je=o(l,"P",{});var jn=s(je);Bt=i(jn,`If you want to create a data migration, use one-shots. If you want to create a data migration with a database
change, separate the two concerns into a Rails migration, then a data migration, then a cleanup migration if
needed. Of course, YMMV, as with any best practice, just make sure your team is onboard with it and, above all,
remember that agreeing on standard practices is the core of a happy team!`),jn.forEach(t),l.forEach(t),this.h()},h(){h(u,"id","on-this-page"),h(k,"href","#a-little-background"),h(N,"href","#migrations-are-only-for-modifying-the-database"),h(Y,"href","#introducing-rails-runner"),h(j,"href","#flow-for-data-migrations"),h(H,"id","a-little-background"),h(B,"id","migrations-are-only-for-modifying-the-database"),h(V,"class","language-ruby"),h(y,"class","note"),h(z,"class","language-ruby"),h(U,"id","introducing-rails-runner"),h($,"id","flow-for-data-migrations"),h(G,"class","language-mermaid"),h(Me,"class","mermaid"),h(a,"class","toc")},m(He,l){ro(He,a,l),e(a,u),e(u,v),e(a,x),e(a,d),e(d,m),e(m,k),e(k,We),e(d,Ze),e(d,C),e(C,N),e(N,Je),e(C,L),e(L,ee),e(ee,Y),e(Y,Ke),e(L,Qe),e(L,ae),e(ae,j),e(j,Xe),e(a,ea),e(a,H),e(H,aa),e(a,ta),e(a,f),e(f,na),e(f,te),e(te,oa),e(f,sa),e(f,ne),e(ne,ra),e(f,ia),e(f,oe),e(oe,la),e(f,ca),e(a,pa),e(a,B),e(B,da),e(a,ha),e(a,b),e(b,ua),e(b,se),e(se,ma),e(b,ga),e(b,re),e(re,fa),e(b,ya),e(a,wa),e(a,ie),e(ie,y),e(y,le),e(le,va),e(y,ka),e(y,V),V.innerHTML=zn,e(y,ba),e(y,P),e(P,_a),e(P,ce),e(ce,Ea),e(P,Ra),e(a,Ia),e(a,D),e(D,Ta),e(D,pe),e(pe,Oa),e(D,Ma),e(a,Aa),e(a,z),z.innerHTML=Un,e(a,xa),e(a,de),e(de,La),e(a,Pa),e(a,he),e(he,Da),e(a,Fa),e(a,F),e(F,Sa),e(F,ue),e(ue,Ca),e(F,Na),e(a,Ya),e(a,_),e(_,me),e(me,ja),e(_,Ha),e(_,ge),e(ge,Ba),e(_,Va),e(_,fe),e(fe,za),e(a,Ua),e(a,ye),e(ye,$a),e(a,Ga),e(a,E),e(E,we),e(we,qa),e(E,Wa),e(E,ve),e(ve,Za),e(E,Ja),e(E,ke),e(ke,Ka),e(a,Qa),e(a,be),e(be,Xa),e(a,et),e(a,U),e(U,at),e(a,tt),e(a,R),e(R,nt),e(R,_e),e(_e,ot),e(R,st),e(R,Ee),e(Ee,rt),e(R,it),e(a,lt),e(a,g),e(g,ct),e(g,Re),e(Re,pt),e(g,dt),e(g,Ie),e(Ie,ht),e(g,ut),e(g,Te),e(Te,mt),e(g,gt),e(g,Oe),e(Oe,ft),e(g,yt),e(a,wt),e(a,$),e($,vt),e(a,kt),e(a,G),G.innerHTML=$n,e(a,bt),e(a,Me),e(a,_t),e(a,Ae),e(Ae,Et),e(a,Rt),e(a,I),e(I,xe),e(xe,O),e(O,It),e(O,Le),e(Le,Tt),e(O,Ot),e(O,Pe),e(Pe,Mt),e(I,At),e(I,De),e(De,M),e(M,xt),e(M,Fe),e(Fe,Lt),e(M,Pt),e(M,Se),e(Se,Dt),e(I,Ft),e(I,Ce),e(Ce,T),e(T,St),e(T,Ne),e(Ne,Ct),e(T,Nt),e(T,Ye),e(Ye,Yt),e(T,jt),e(a,Ht),e(a,je),e(je,Bt)},p:io,d(He){He&&t(a)}}}function po(S){let a,u;const v=[S[0],Vn];let x={$$slots:{default:[co]},$$scope:{ctx:S}};for(let d=0;d<v.length;d+=1)x=zt(x,v[d]);return a=new lo({props:x}),{c(){Xn(a.$$.fragment)},l(d){eo(a.$$.fragment,d)},m(d,m){ao(a,d,m),u=!0},p(d,[m]){const k=m&1?to(v,[m&1&&Hn(d[0]),m&0&&Hn(Vn)]):{};m&2&&(k.$$scope={dirty:m,ctx:d}),a.$set(k)},i(d){u||(no(a.$$.fragment,d),u=!0)},o(d){oo(a.$$.fragment,d),u=!1},d(d){so(a,d)}}}const Vn={comments:!0,view:"post",layout:"post",lang:"en",author:"skamansam",title:"Data Migrations and You!",description:"Best Practices for Data Migrations",excerpt:"Here was the chance to lose some old, bad habits, and replace them with new _Patterns_!",cover:!1,coverImage:!1,coverAlt:"RBE Logo",categories:["programming","Ruby"],tags:["best practices","design patterns","Rude Boy Solutions"],created_at:"2016-09-14T10:06:59.000Z",updated_at:"2016-09-14T10:06:59.000Z",opengraphImage:null,twitterImage:null};function ho(S,a,u){return S.$$set=v=>{u(0,a=zt(zt({},a),Bn(v)))},a=Bn(a),[a]}class go extends Jn{constructor(a){super(),Kn(this,a,ho,po,Qn,{})}}export{go as default,Vn as metadata};
