<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="../favicon/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#999999">
    <meta name="msapplication-TileColor" content="#cccccc">
    <meta name="theme-color" content="#eeeeee">
		<meta http-equiv="content-security-policy" content=""><title>Building a unified `time_select` field | RBE</title><meta property="og:image" content="/images/GSoC-logo-horizontal-800.png" data-svelte="svelte-gwb5t8"><meta content="/images/GSoC-logo-horizontal-800.png" data-svelte="svelte-gwb5t8"><meta property="og:site_name" content="Rude Boy Solutions" data-svelte="svelte-gwb5t8"><meta property="article:published_time" content="2013-04-10T11:10:11.000Z" data-svelte="svelte-gwb5t8"><meta property="article:author" content="skamansam" data-svelte="svelte-gwb5t8"><meta property="og:url" content="" data-svelte="svelte-gwb5t8"><meta property="og:type" content="article" data-svelte="svelte-gwb5t8"><meta property="og:title" content="Building a unified `time_select` field - RBE" data-svelte="svelte-gwb5t8"><meta property="og:image" content="false" data-svelte="svelte-gwb5t8"><meta property="og:description" content="Build a unified `time_select` field" data-svelte="svelte-gwb5t8"><meta name="twitter:card" content="summary" data-svelte="svelte-gwb5t8"><meta property="twitter:site" content="@skamansam" data-svelte="svelte-gwb5t8"><meta name="twitter:creator" content="@skamansam" data-svelte="svelte-gwb5t8"><meta name="twitter:image" content="false" data-svelte="svelte-gwb5t8"><meta name="description" content="Build a unified `time_select` field" data-svelte="svelte-gwb5t8">
	<link rel="stylesheet" href="/_app/immutable/assets/pages/__layout.svelte-4739f310.css">
	<link rel="modulepreload" href="/_app/immutable/start-6cf47892.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/index-f095e7d9.js">
	<link rel="modulepreload" href="/_app/immutable/pages/__layout.svelte-d2dbcbfa.js">
	<link rel="modulepreload" href="/_app/immutable/pages/posts/2013-04-10-building-a-unified-time-select-field.md-4de0a314.js">
	<link rel="modulepreload" href="/_app/immutable/chunks/post-34b2f3fb.js">
			<script>
		if ('serviceWorker' in navigator) {
			addEventListener('load', () => {
				navigator.serviceWorker.register('/service-worker.js');
			});
		}
	</script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1CV0J6F3VM"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script> -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-G3FBL50ZMF');
    </script>
  </head>
	<body>
		


<div class="theme-wrapper light theme- h-screen w-screen p-0 m-0 flex flex-col items-stretch"><header class="site-head flex  svelte-1b8k5if"><div class="header-logo inline-block"><img src="/rbe_logo.gif" alt="Rude Boy Enterprises Logo" width="100"></div>
	<div class="flex flex-col grow justify-center ml-3"><div class="text-4xl text-onPrimaryBg">Rude Boy Solutions</div>
		<div class="indent-5">Solutions. For Life.</div></div>
	<div class="mt-2 mr-2 text-sm"><label for="themeSelector">Theme: </label>
		<select id="themeSelector"><option value="">plain</option><option value="neumorphic">neumorphic</option><option value="glassmorphic">glassmorphic</option><option value="brutal">brutal</option></select>

		<label for="toggle-dark" class="flex items-center cursor-pointer relative mb-4"><span class="mr-3 text-gray-900 text-sm font-medium flex-grow">Dark Mode</span>
			<input type="checkbox" id="toggle-dark" class="sr-only svelte-1b8k5if">
			<div class="toggle-bg bg-gray-200 border-2 border-gray-200 h-6 mr-5 w-11 rounded-full self-end svelte-1b8k5if"></div></label></div>
</header>
  <nav class="sidebar "><ul class=""><li><a href="/portfolio">Portfolio</a></li>
    <li><a href="/posts">Blog</a></li>
    <li><a href="/about">About</a></li>
    <li><a href="/contact">Contact</a></li>
    <li><a href="/demo">MD Demo</a></li></ul></nav>
  <div class="pl-2 pt-2">



<main><article><hgroup><h1>Building a unified `time_select` field</h1>
			<p class="date created_at">posted on: 4/10/2013, 11:10:11 AM</p>
			
			<p class="author">by: skamansam</p></hgroup>
		<div class="description hidden">Build a unified `time_select` field</div>
		<p>Before I migrated to Rails 3.2, I used a plugin to provide a unified input field
for time_select with either the standard Rails ActionView or the SimpleForm gem
(SimpleForm uses ActionView under the hood). I was happy until the Rails upgrade
caused my gem toÂ inexplicablyÂ stop working. I had a deadline to meet and could
not be bothered with complicated solutions. I searched and searched for
alternatives to this fine gem, but none were found. Then it hit me: why not just
write my own code and replace the inputs with my own code? Surely it canâ€™t take
too long to build a time input based on the simple_time_select gem!Â So here it
is: my simple version of the gem, with only a few modifications from the
simple_time_select gem.</p>
<p>Here is my old code, utilizing simple_time_select. The gem is used only
ifÂ <code>:simple_time_select</code> is true, and itÂ uses the <code>:minute_interval</code>,
<code>:time_separator</code>, <code>:start_hour</code>, <code>:end_hour</code>, and a host of other options for setting
the times. I wish it had a way for specifying just a start_time and end_time.</p>
<pre class="language-ruby"><!-- HTML_TAG_START --><code class="language-ruby"><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string-literal"><span class="token string">"field"</span></span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">%=</span> f<span class="token punctuation">.</span>input <span class="token symbol">:start_time</span><span class="token punctuation">,</span>
              <span class="token symbol">:label</span><span class="token operator">=></span><span class="token string-literal"><span class="token string">"Start Time:"</span></span><span class="token punctuation">,</span>
              <span class="token symbol">:default</span><span class="token operator">=></span>appt<span class="token punctuation">.</span>start_time<span class="token punctuation">,</span>
              <span class="token symbol">:wrapper</span><span class="token operator">=></span><span class="token boolean">false</span><span class="token punctuation">,</span>
              <span class="token symbol">:simple_time_select</span> <span class="token operator">=></span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token symbol">:label_html</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token symbol">:class</span><span class="token operator">=></span><span class="token string-literal"><span class="token string">"head"</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
              <span class="token symbol">:minute_interval</span> <span class="token operator">=></span> <span class="token number">5</span><span class="token punctuation">,</span>
              <span class="token symbol">:time_separator</span> <span class="token operator">=></span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">,</span>
              <span class="token symbol">:start_hour</span> <span class="token operator">=></span> <span class="token number">06</span><span class="token punctuation">,</span>
              <span class="token symbol">:end_hour</span> <span class="token operator">=></span> <span class="token number">17</span>
   <span class="token string-literal"><span class="token string">%>
&lt;/div></span></span></code><!-- HTML_TAG_END --></pre>
<p>I had to search for an algorithm to use for the periodicity, and settled on the
algorithm discussed in <a href="http://stackoverflow.com/questions/6783589/display-15-minute-steps-between-two-given-times" rel="nofollow">this discussion on Stack
Overflow</a>,
and is inlined as the :collection option. Since the ðŸ˜›efault option removes the
inital blank I wanted as the first item in the list, I has to add a blank
<code>:include_blank</code> option.</p>
<pre class="language-ruby"><!-- HTML_TAG_START --><code class="language-ruby"><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string-literal"><span class="token string">"field"</span></span><span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token string-literal"><span class="token string">%- time_start = Time.now.change(:hour=>6,:minute=>0) %>
  &lt;%-</span></span> time_end <span class="token operator">=</span> <span class="token builtin">Time</span><span class="token punctuation">.</span>now<span class="token punctuation">.</span>change<span class="token punctuation">(</span><span class="token symbol">:hour</span><span class="token operator">=></span><span class="token number">17</span><span class="token punctuation">,</span><span class="token symbol">:minute</span><span class="token operator">=></span><span class="token number">55</span><span class="token punctuation">)</span> <span class="token string-literal"><span class="token string">%>
  &lt;%- period = 5.minutes %></span></span>
  <span class="token operator">&lt;</span><span class="token operator">%=</span> f<span class="token punctuation">.</span>input <span class="token symbol">:start_time</span><span class="token punctuation">,</span>
           <span class="token symbol">:as</span><span class="token operator">=></span><span class="token symbol">:collection_select</span><span class="token punctuation">,</span>
           <span class="token symbol">:required</span><span class="token operator">=></span><span class="token boolean">true</span><span class="token punctuation">,</span>
           <span class="token symbol">:include_blank</span> <span class="token operator">=></span> <span class="token string-literal"><span class="token string">''</span></span><span class="token punctuation">,</span>
           <span class="token symbol">:selected</span><span class="token operator">=></span><span class="token punctuation">(</span>
             f<span class="token punctuation">.</span>object<span class="token punctuation">.</span>start_time<span class="token punctuation">.</span>blank<span class="token operator">?</span> <span class="token operator">?</span>
               <span class="token string-literal"><span class="token string">""</span></span> <span class="token operator">:</span> f<span class="token punctuation">.</span>object<span class="token punctuation">.</span>start_time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"%H:%M"</span></span><span class="token punctuation">)</span>
           <span class="token punctuation">)</span><span class="token punctuation">,</span>
           <span class="token symbol">:input_html</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
             <span class="token symbol">:name</span><span class="token operator">=></span><span class="token string-literal"><span class="token string">"appt[start_time(5i)]"</span></span><span class="token punctuation">,</span>
             <span class="token symbol">:id</span><span class="token operator">=></span><span class="token string-literal"><span class="token string">"appt_start_time_5i"</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
           <span class="token symbol">:collection</span><span class="token operator">=></span> <span class="token punctuation">(</span>
             <span class="token punctuation">[</span>time_start<span class="token punctuation">]</span><span class="token punctuation">.</span>tap<span class="token punctuation">&#123;</span>
               <span class="token operator">|</span>array<span class="token operator">|</span> array <span class="token operator">&lt;&lt;</span> array<span class="token punctuation">.</span>last <span class="token operator">+</span> period
                 <span class="token keyword">while</span> array<span class="token punctuation">.</span>last <span class="token operator">&lt;</span> time_end
             <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">&#123;</span>
               <span class="token operator">|</span>t<span class="token operator">|</span> <span class="token punctuation">[</span>t<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"%l:%M %p"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"%H:%M"</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span>
             <span class="token punctuation">&#125;</span>
   <span class="token string-literal"><span class="token string">%>
&lt;/div></span></span></code><!-- HTML_TAG_END --></pre>
<p>I am sure you can wrap this in a Helper class somewhere, and it should be easy
to monkeypatch ActiveView or SimpleForm to display this instead of the default.</p>
<p>References:</p>
<ul><li><a href="http://stackoverflow.com/questions/6783589/display-15-minute-steps-between-two-given-times" rel="nofollow">Stack Overflow discussion on time periodicity in Rails</a> (used for periodicity algorithm)</li>
<li><a href="http://www.tonyamoyal.com/2009/04/21/simple-time-select-the-most-compact-time_select-for-ruby-on-rails/" rel="nofollow">Tutorial on using simple_time_select</a></li>
<li><a href="https://github.com/plataformatec/simple_form" rel="nofollow">SimpleForm gem</a></li>
<li><a href="https://github.com/tamoyal/simple_time_select" rel="nofollow">simple_time_select gem</a></li></ul></article></main></div></div>


		<script type="module" data-sveltekit-hydrate="k6h4l6">
		import { start } from "/_app/immutable/start-6cf47892.js";
		start({
			target: document.querySelector('[data-sveltekit-hydrate="k6h4l6"]').parentNode,
			paths: {"base":"","assets":""},
			session: {},
			route: true,
			spa: false,
			trailing_slash: "never",
			hydrate: {
				status: 200,
				error: null,
				nodes: [0, 41],
				params: {},
				routeId: "posts/2013-04-10-building-a-unified-time-select-field"
			}
		});
	</script>
	</body>
</html>
